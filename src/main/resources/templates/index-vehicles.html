<!DOCTYPE html>
<html lang="en"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{base}">
<head>
    <title>Available Vehicles</title>
</head>
<section layout:fragment="content">
    <div class="container mt-5">

        <h2 class="text-center mb-4">Find Available Vehicles</h2>

        <div th:if="${error}" class="alert alert-danger" th:text="${error}"></div>

        <div class="mb-4">
            <form th:action="@{/vehicles/available}" method="get" class="row g-3">

                <div class="col-md-3">
                    <label for="startDate" class="form-label">Start Date</label>
                    <input type="date" class="form-control" id="startDate" name="startDate"
                           th:value="${startDate}">
                </div>

                <div class="col-md-3">
                    <label for="endDate" class="form-label">End Date</label>
                    <input type="date" class="form-control" id="endDate" name="endDate"
                           th:value="${endDate}">
                </div>

                <div class="col-md-4">
                    <label for="categorySelect" class="form-label">Category</label>
                    <select class="form-select" id="categorySelect" name="categoryId">
                        <option value="" th:selected="${categoryId == null}">All Categories</option>
                        <option th:each="category : ${categories}"
                                th:value="${category.id}"
                                th:text="${category.type} + ' - ' + ${category.subtype}"
                                th:selected="${categoryId != null} ? ${category.id == categoryId} : false">
                        </option>
                    </select>
                </div>

                <div class="col-md-2 d-flex align-items-end">
                    <button type="submit" class="btn btn-primary w-100">Search</button>
                </div>

            </form>
        </div>

        <div th:if="${vehicles != null}">

            <div class="mb-3 text-center">
                <h5>
                    Showing vehicles available from
                    <span th:text="${#dates.format(startDate, 'yyyy-MM-dd')}">Start Date</span>
                    to
                    <span th:text="${#dates.format(endDate, 'yyyy-MM-dd')}">End Date</span>
                    <span th:if="${categoryId != null}">
                        in
                        <span th:each="c : ${categories}" th:if="${c.id == categoryId}"
                              th:text="${c.type} + ' - ' + ${c.subtype}"></span>
                    </span>
                </h5>
            </div>

            <div th:if="${#lists.isEmpty(vehicles)}" class="text-center">
                <p>No available vehicles for the selected dates or category.</p>
            </div>

            <div class="row g-4" th:if="${!#lists.isEmpty(vehicles)}">
                <div class="col-12" th:each="vehicle : ${vehicles}">
                    <div class="card shadow-sm mb-3">
                        <div class="row g-0">

                            <div class="col-md-4">
                                <img th:if="${vehicle.category.imageUrl != null}" th:src="@{${vehicle.category.imageUrl}}"
                                     class="img-fluid rounded-start" alt="Category image">
                                <img th:if="${vehicle.category.imageUrl == null}"
                                     src="/images/placeholder-car.png" class="img-fluid rounded-start" alt="Placeholder image">
                            </div>

                            <div class="col-md-8">
                                <div class="card-body">

                                    <div class="d-flex justify-content-between mb-1">
                                        <h5 class="card-title mb-0" th:text="${vehicle.make} + ' ' + ${vehicle.model}"></h5>
                                        <div class="text-primary"
                                             th:text="'$' + ${vehicle.dailyRate} + ' / day'"></div>
                                    </div>

                                    <div class="d-flex justify-content-between mb-1">
                                        <div><strong>Year:</strong> <span th:text="${vehicle.year}"></span></div>
                                        <div></div>
                                    </div>

                                    <div class="d-flex justify-content-between mb-1">
                                        <div><strong>Color:</strong> <span th:text="${vehicle.color}"></span></div>
                                        <div class="fw-bold">Total Price (<span th:text="${rentalDays}"></span> days):</div>
                                    </div>

                                    <div class="d-flex justify-content-between mb-1">
                                        <div><strong>Category:</strong> <span th:text="${vehicle.category.type} + ' - ' + ${vehicle.category.subtype}"></span></div>
                                        <div class="fw-bold text-success fs-5"
                                             th:text="'$' + ${vehicle.totalPrice}">
                                        </div>
                                    </div>

                                    <div class="mt-3">
                                        <a th:href="@{'/vehicle/details/' + ${vehicle.id}}" class="btn btn-primary btn-sm">View Details</a>
                                        <a th:href="@{'/reservation/book/' + ${vehicle.id}}" class="btn btn-success btn-sm">Book Now</a>
                                    </div>

                                </div>
                            </div>

                        </div>
                    </div>
                </div>
            </div>

        </div>

    </div>
</section>
</html>